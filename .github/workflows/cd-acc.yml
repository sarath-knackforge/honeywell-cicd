name: CD-ACC

on:
  push:
    branches:
      - main

jobs:
  deploy-acc:
    name: Deploy to ACC Databricks Workspace
    runs-on: ubuntu-latest

    environment:
      name: acc   # GitHub Environment (optional approval gate)

    permissions:
      contents: read

    env:
      # üëâ ACC WORKSPACE CREDENTIALS (DIFFERENT FROM DEV)
      DATABRICKS_HOST: ${{ vars.DATABRICKS_ACC_HOST }}
      DATABRICKS_CLIENT_ID: ${{ secrets.DATABRICKS_ACC_CLIENT_ID }}
      DATABRICKS_CLIENT_SECRET: ${{ secrets.DATABRICKS_ACC_CLIENT_SECRET }}
      DATABRICKS_BUNDLE_ENV: acc

    steps:
      # ------------------------------------------------------------
      # 1Ô∏è‚É£ Checkout main branch
      # ------------------------------------------------------------
      - name: Checkout source
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # ------------------------------------------------------------
      # 2Ô∏è‚É£ Install Databricks CLI
      # ------------------------------------------------------------
      - name: Install Databricks CLI
        uses: databricks/setup-cli@v0.246.0

      # ------------------------------------------------------------
      # 3Ô∏è‚É£ Deploy bundle to ACC workspace
      # ------------------------------------------------------------
      - name: Deploy bundle to ACC workspace
        run: |
          databricks bundle deploy \
            --var="git_sha=${{ github.sha }}" \
            --var="branch=main"

      # ------------------------------------------------------------
      # 4Ô∏è‚É£ Run ACC deployment job
      # ------------------------------------------------------------
      # - name: Run ACC deployment workflow
      #   run: |
      #     databricks bundle run deployment -t acc
